<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: file-loader.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: file-loader.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*
 * file-loader.js - Copyright (C) 2017-2018
 *
 * Will load files for http server.
 *
 * File is licenced under project's global licence.
 * See Licence.txt for more details.
 */
/**
 * @module lang
 */
const errors = require("./errors.js"),
    filename = "file-loader.js";

try {
    const fs = require("fs"),
        path = require("path"),
        url = require("url"),
        mimeTypes = require("mime-types").lookup;
    path.sep = "/";
} catch (err) {
    throw new errors.LoadingError(filename);
}

/**
 * FileLoader - Will load files for http server.
 */
class FileLoader {
    /**
     * @param {String} name The file name.
     * @param {Object} [httpres] HTTPResponse For Automatic Delivery of Content.
     */
    constructor(name = new errors.ArgsError("FileLoader", 1, "Name", filename), httpres) {
        try {
            this.name = url.format(name).split(/\?/g)[0];
            this.res = httpres;
        } catch (err) {
            throw new errors.InternalError(filename);
        }
    }

    /**
     * mimeType - Will detect MIME type of a extension
     *
     * @param {String} type Extension of file
     * @returns {String} MIME type of extension
     * @private
     */
    mimeType(type = new errors.ArgsError("FileLoader.mimeType", 1, "type", filename)) {
        try {
            return mimeTypes(type) || "application/octet-stream";
        } catch (err) {
            throw new errors.DepError(filename);
        }
    }

    /**
     * load - Will Load Content. Please Note:
     * If The httpres was included, This will return undefined.
     * But, If not, It will return a Promise.
     *
     * @returns {undefined|Promise}
     */
    load() {
        try {
            let exist;
            exist = fs.existsSync(this.name);
            if (!exist) {
                if (this.end) {
                    this.res.statusCode = 404;
                    this.res.end(`Failed loading ${this.name}.`);
                }
                return;
            }
            if (fs.statSync(this.name).isDirectory())
                this.name = path.join(this.name, "/index.html");
            if (this.res)
                fs.readFile(this.name, (err, data) => {
                    if (err) {
                        this.res.statusCode = 500;
                        this.res.end(`Failed reading ${this.name}.`);
                        return;
                    }

                    this.res.setHeader("Content-type", this.mimeType(path.parse(this.name).ext));
                    this.res.end(callback(data));
                });
            else
                return new Promise((ful, rej) => {
                    fs.readFile(this.name, (err, data) => {
                        if (err)
                            rej(err);

                        ful(data);
                    });
                });
        } catch (err) {
            throw new errors.EnvError(filename);
        }
    }
}

module.exports = FileLoader;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-errors.html">errors</a></li><li><a href="module-lang.html">lang</a></li><li><a href="module-theme.html">theme</a></li></ul><h3>Classes</h3><ul><li><a href="module-errors-ArgsError.html">ArgsError</a></li><li><a href="module-errors-DepError.html">DepError</a></li><li><a href="module-errors-EnvError.html">EnvError</a></li><li><a href="module-errors-ExternalError.html">ExternalError</a></li><li><a href="module-errors-InternalError.html">InternalError</a></li><li><a href="module-errors-LoadingError.html">LoadingError</a></li><li><a href="module-errors-RuntimeError.html">RuntimeError</a></li><li><a href="module-lang-FileLoader.html">FileLoader</a></li><li><a href="module-lang-Lang.html">Lang</a></li><li><a href="module-theme-Theme.html">Theme</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-getting-started.html">getting-started</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a>
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
